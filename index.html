
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>> /dev/null</title>
	<meta name="author" content="leoh0">

	
	<meta name="description" content="kubernetes 로 openstack mitaka를 설치해 봤습니다. 아래 로그 및 시연을 만들어 봤습니다. 클릭하면 전과정을 보실 수 있습니다. 참고하시면 좋을 것 같습니다. 클릭해서 과정 보기 대략 31분 정도 걸려서 minikube 구성 부터 전체 셋업 및 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="> /dev/null&#8221; type=&#8221;application/atom+xml&#8221;>
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">> /dev/null</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:leoh0.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/104543023220946300714?rel=author" title="Google+">Google+</a>
		
		
		
		<a class="github" href="https://github.com/leoh0" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:leoh0.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/10/13/install-openstack-on-macos-sierra-using-kolla-kubernetes-and-xhyve/">
		
			Install Openstack on Macos Sierra Using Kolla-kubernetes With Xhyve</a>
	</h2>
	<div class="entry-content">
		<p><code>kubernetes</code> 로 <code>openstack mitaka</code>를 설치해 봤습니다.</p>

<p>아래 로그 및 시연을 만들어 봤습니다. 클릭하면 전과정을 보실 수 있습니다. 참고하시면 좋을 것 같습니다.</p>

<p><a href="http://showterm.io/404f651b005c52298bc9f"><img src="/images/2016-10-13_00-04-57.jpg" width="924" height="533"></a>
<a href="http://showterm.io/404f651b005c52298bc9f">클릭해서 과정 보기</a></p>

<p>대략 31분 정도 걸려서 minikube 구성 부터 전체 셋업 및 vm 2개 띄워서 로그인 테스트 합니다.</p>

<p>그리고 저는 <code>macos Sierra</code> 에서 <code>xhyve</code> 로 8G 머신을 만들어서 사용을 했습니다.  <br/>
linux 머신이 있으면 kvm을 이용하시는 것도 좋을것 같습니다.  <br/>
windows 환경에선 xhyve 외에도 virtual box 등을 이용하셔도 좋을 것 같습니다.</p>

<p>셋업할때 <code>kubernetes-cli</code> 는 <code>1.3.6</code> 버전과 <code>minikube</code> 는 <code>0.11.0</code> 버전을 이용합니다.</p>

<p>앞서 말한 2가지 버전만 잘 지키고 bootstraping 이나 container가 올라올때 잘 기다리고 진행하면 크게 어렵게 진행 하실 수 있습니다.</p>

<p>자세한건 <a href="https://github.com/openstack/kolla-kubernetes/blob/master/doc/source/minikube-quickstart.rst">kolla-kubernetes의 도큐먼트</a>를 참고하시면 도움이 되실 겁니다.</p>

<p>kolla-kubernetes 를 이용한 방법으로 기존 kolla 와 비슷한 플로우로 진행합니다.  <br/>
아무튼 그냥 devstack 처럼 테스트 용으로 보시면 좋을겁니다.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-10-13T00:02:06+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/container/'>container</a>, <a class='category' href='/blog/categories/docker/'>docker</a>, <a class='category' href='/blog/categories/install-openstack/'>install openstack</a>, <a class='category' href='/blog/categories/kolla/'>kolla</a>, <a class='category' href='/blog/categories/kolla-kubernetes/'>kolla-kubernetes</a>, <a class='category' href='/blog/categories/kubernetes/'>kubernetes</a>, <a class='category' href='/blog/categories/macos/'>macos</a>, <a class='category' href='/blog/categories/mitaka/'>mitaka</a>, <a class='category' href='/blog/categories/openstack/'>openstack</a>, <a class='category' href='/blog/categories/sierra/'>sierra</a>


</div>
	
	<div class="comments"><a href="/blog/2016/10/13/install-openstack-on-macos-sierra-using-kolla-kubernetes-and-xhyve/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/09/29/cuga-edit-vagrant-box-for-vagrant-libvirt/">
		
			추가 - Edit Vagrant Box for Vagrant-libvirt</a>
	</h2>
	<div class="entry-content">
		<h1>copy image and files</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir -p images
</span><span class='line'>cp ~/.vagrant.d/boxes/<span class="k">${</span><span class="nv">TARGETIMAGE</span><span class="k">}</span>/0/libvirt/* images/
</span><span class='line'><span class="nb">cd </span>images
</span></code></pre></td></tr></table></div></figure>


<h1>init</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apt-get install -qqy lvm2
</span><span class='line'>modprobe nbd
</span></code></pre></td></tr></table></div></figure>


<h1>attach</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>qemu-nbd -c /dev/nbd0 <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/box.img
</span><span class='line'>vgscan
</span><span class='line'>vgchange -ay
</span><span class='line'>mount /dev/mapper/vagrant--vg-root /mnt
</span></code></pre></td></tr></table></div></figure>


<h1>bind</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">binds</span><span class="o">=</span><span class="s2">&quot;/dev /dev/pts /proc /sys /run&quot;</span>
</span><span class='line'><span class="k">for</span> d in <span class="nv">$binds</span><span class="p">;</span> <span class="k">do</span>
</span><span class='line'>  mkdir -p /mnt<span class="k">${</span><span class="nv">d</span><span class="k">}</span>
</span><span class='line'>  mount --bind <span class="k">${</span><span class="nv">d</span><span class="k">}</span> /mnt<span class="k">${</span><span class="nv">d</span><span class="k">}</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<h1>work</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chroot /mnt bash
</span><span class='line'><span class="c"># blah blah blah</span>
</span><span class='line'><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<h1>unbind and detach</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /
</span><span class='line'><span class="k">for</span> d in <span class="k">$(</span>mount <span class="p">|</span> awk <span class="s1">&#39;/\/mnt/{print $3}&#39;</span> <span class="p">|</span> sort -r<span class="k">)</span><span class="p">;</span> <span class="k">do</span>
</span><span class='line'>  umount <span class="nv">$d</span>
</span><span class='line'><span class="k">done</span>
</span><span class='line'>vgchange -an vagrant-vg
</span><span class='line'>qemu-nbd -d /dev/nbd0
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-09-29T23:39:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/libvirt/'>libvirt</a>, <a class='category' href='/blog/categories/vagrant/'>vagrant</a>


</div>
	
	<div class="comments"><a href="/blog/2016/09/29/cuga-edit-vagrant-box-for-vagrant-libvirt/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/09/29/cuga-keystoneeseo-token-backendro-sayonghaneun-memcachedga-unbalanceddoeeossda-dot/">
		
			추가 - Keystone에서 Token Backend로 사용하는 Memcached가 Unbalanced되었다..</a>
	</h2>
	<div class="entry-content">
		<p>예전에 아래글을 그냥 balancing 을 위해 id 를 잘 분배하자 라는식으로 결론 냈지만.</p>

<p><a href="http://leoh0.github.io/blog/2016/04/27/keystoneeseo-token-backendro-sayonghaneun-memcachedga-unbalanceddoeeossdamyeon-dot/">Keystone에서 Token Backend로 사용하는 Memcached가 Unbalanced되었다..</a></p>

<p>user의 token리스트를 관리하지 않으면 부담은 훨씬 줄어든다.</p>

<p>물론 user의 password 변경 등으로 기존 모든 token을 revoke 시키는 경우때문에 이런 user 단위로 token리스트를 관리해야 하지만  <br/>
그걸 포기하면 그냥 코드 몇줄 추가로 간단하게 정리할 수 있다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gh">diff --git a/keystone/token/persistence/backends/memcache.py b/keystone/token/persistence/backends/memcache.py</span>
</span><span class='line'><span class="gh">index e6b0fca..3f0de68 100644</span>
</span><span class='line'><span class="gd">--- a/keystone/token/persistence/backends/memcache.py</span>
</span><span class='line'><span class="gi">+++ b/keystone/token/persistence/backends/memcache.py</span>
</span><span class='line'><span class="gu">@@ -37,3 +37,6 @@ class Token(kvs.Token):</span>
</span><span class='line'>         kwargs[&#39;memcached_expire_time&#39;] = CONF.token.expiration
</span><span class='line'>         kwargs[&#39;url&#39;] = CONF.memcache.servers
</span><span class='line'>         super(Token, self).__init__(*args, **kwargs)
</span><span class='line'><span class="gi">+</span>
</span><span class='line'><span class="gi">+    def _update_user_token_list(self, user_key, token_id, expires_isotime_str):</span>
</span><span class='line'><span class="gi">+        return []</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-09-29T23:30:20+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/keystone/'>keystone</a>, <a class='category' href='/blog/categories/memcached/'>memcached</a>, <a class='category' href='/blog/categories/openstack/'>openstack</a>, <a class='category' href='/blog/categories/skew/'>skew</a>, <a class='category' href='/blog/categories/token/'>token</a>, <a class='category' href='/blog/categories/unbalance/'>unbalance</a>


</div>
	
	<div class="comments"><a href="/blog/2016/09/29/cuga-keystoneeseo-token-backendro-sayonghaneun-memcachedga-unbalanceddoeeossda-dot/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/05/17/mac-os-x-nslookup/">
		
			Mac Os X - Nslookup, Host, Dig Works With /etc/resolv.conf, but Ping, Ssh Doesnt Work</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2016-05-17_03-24-13.jpg" width="650" height="167"></p>

<p>Mac os x 는 linux와 다른 resolving을 제공한다.</p>

<p>간단하게만 이야기 하면 /etc/resolv.conf 외에도 /etc/resolver/* 에 원하는 dns명을 기록해 놓으면 해당 domain name을 갖을시 해당하는 nameserver로 쿼리를 할 수가 있다.</p>

<p>예를 들어 아래와 같이 설정했다면 *.local 과 같은 도메인은 10.10.1.65로 dns 서버를 사용가능하다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/resolver/local
</span><span class='line'>nameserver 10.10.1.65</span></code></pre></td></tr></table></div></figure>


<p>다만 이건 nslookup, host, dig 와 같은 dns lookup command 들에서는 나타나지 않는다. 이런 커맨드는 linux와 같이 /etc/resolv.conf 의 dns 서버를 이용해서 lookup을 하게 된다. (/etc/hosts 도..)</p>

<p>아무튼 이 설명은 아래 커맨드 들의 man page를 보면 알수 있다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ man dig
</span><span class='line'>...
</span><span class='line'>Mac OS X NOTICE
</span><span class='line'>       The dig command does not use the host name and address resolution or the DNS query routing mechanisms used by other processes running on Mac OS X.  The results of name or address queries printed by dig may
</span><span class='line'>       differ from those found by other processes that use the Mac OS X native name and address resolution mechanisms.  The results of DNS queries may also differ from queries that use the Mac OS X DNS routing
</span><span class='line'>       library.
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ man nslookup
</span><span class='line'>...
</span><span class='line'>Mac OS X NOTICE
</span><span class='line'>       The nslookup command does not use the host name and address resolution or the DNS query routing mechanisms used by other processes running on Mac OS X.  The results of name or address queries printed by
</span><span class='line'>       nslookup may differ from those found by other processes that use the Mac OS X native name and address resolution mechanisms.  The results of DNS queries may also differ from queries that use the Mac OS X DNS
</span><span class='line'>       routing library.
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ man host
</span><span class='line'>...
</span><span class='line'>Mac OS X NOTICE
</span><span class='line'>       The host command does not use the host name and address resolution or the DNS query routing mechanisms used by other processes running on Mac OS X.  The results of name or address queries printed by host may
</span><span class='line'>       differ from those found by other processes that use the Mac OS X native name and address resolution mechanisms.  The results of DNS queries may also differ from queries that use the Mac OS X DNS routing
</span><span class='line'>       library.
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>하지만 ssh, ping은 /etc/resolver/* 외에도 설정되어 있는 resolver dns 로 쿼리를 하게 된다. 그렇기 때문에 한쪽에서는(nslookup, dig, host) 되고 한쪽(ping, ssh 외 다수)에서는 안되는 케이스가 발생한다.</p>

<p>그렇다면 이것을 어떻게 확인 할 수 있을까?  <br/>
가장 간단한 방법은 아래와 같다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ scutil --dns</span></code></pre></td></tr></table></div></figure>


<p>결과는 아래와 같이 resolver 들과 그들의 순위(order)를 확인 할 수 있다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ scutil --dns
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>resolver #2
</span><span class='line'>  domain   : 1015140824.members.btmm.icloud.com
</span><span class='line'>  options  : pdns
</span><span class='line'>  timeout  : 5
</span><span class='line'>  flags    : Request A records
</span><span class='line'>Not Reachable
</span><span class='line'>  order    : 150000
</span><span class='line'>
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>resolver #4
</span><span class='line'>  domain   : local
</span><span class='line'>  options  : mdns
</span><span class='line'>  timeout  : 5
</span><span class='line'>  flags    : Request A records
</span><span class='line'>Not Reachable
</span><span class='line'>  order    : 300000
</span><span class='line'>
</span><span class='line'>resolver #5
</span><span class='line'>  domain   : 254.169.in-addr.arpa
</span><span class='line'>  options  : mdns
</span><span class='line'>  timeout  : 5
</span><span class='line'>  flags    : Request A records
</span><span class='line'>Not Reachable
</span><span class='line'>  order    : 300200
</span><span class='line'>
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>사족으로 여기에서도 만약에 local 순위가 300000(default) 가 마음에 안들면 아래와 같이 resolver 에 추가 하면 100000으로 변경이 가능하다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/resolver/local
</span><span class='line'>nameserver 10.10.1.65
</span><span class='line'>search_order 100000</span></code></pre></td></tr></table></div></figure>


<p>이런 설정이 일반적으로는 필요하지 않지만 아래와 같은 vpn을 사용하는 케이스에서 발생했었다.</p>

<p>우선 아래와 같은 커맨드로 /etc/resolv.conf 에 원하는 search domain들을 network interface 당 추가가 가능하다. (아니면 환경 설정에서 추가..)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo networksetup -setsearchdomains 'WI-FI' local</span></code></pre></td></tr></table></div></figure>


<p>이러면 대략 아래와 같이 local 을 search 구문으로 사용가능하다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/resolv.conf
</span><span class='line'>...
</span><span class='line'>search local
</span><span class='line'>nameserver 8.8.8.8</span></code></pre></td></tr></table></div></figure>


<p>일반적으로 이렇게 사용하는게 문제가 되지 않지만 만약 junos pulse 같은 vpn을 사용시 vpn에서 주어주는 search domain이 아닐시 자신의 기존 search domain 들은 원래 nameserver로 가도록 설정되어 있다.</p>

<p>예를 들면 이렇다.</p>

<p>A, B 라는 search domain을 (가)라는 dns를 사용하는데
만약 vpn에서 B, C 라는 search domain을 (나)라는 dns로 주어지면
아래와 같이 정리된다.</p>

<p>A, B, C search domain을 사용하는 것은 default 로 (나) 로 사용되나.  <br/>
이것보다 높은 order 로 A 가 (가)로 한개 더 설정된다.</p>

<p>이런 케이스에는 A domain은 (나)로 질의 하고 싶어도 (가)로 질의 하게 되는 문제가 있다.</p>

<p>vpn 측에서 모든 search domain을 내려주면 해결할 수 있지만 이런게 힘들 시에는 <a href="https://gist.github.com/b4ldr/f9d6aab4837ae18d908f">여기</a> <a href="http://diaryproducts.net/about/operating_systems/mac_os_x/overriding_dhcp_or_vpn_assigned_dns_servers_in_mac_os_x_leopard">여기</a> 와 같이 직접 scutil 을 통해서 VPN의 DNS 값들을 수정해 줄 수 있다. (아니면 위와 같이 /etc/resolver/local 과 같이 파일을 만들어도 됨)</p>

<p>추가적으로 아래와 같은 커맨드로 debugging 을 가능하다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># enable operation logging.
</span><span class='line'>sudo killall -USR1 mDNSResponder
</span><span class='line'>
</span><span class='line'># enable packet logging.
</span><span class='line'>sudo killall -USR2 mDNSResponder
</span><span class='line'>
</span><span class='line'># clear the DNS cache.
</span><span class='line'>sudo killall -HUP mDNSResponder
</span><span class='line'>
</span><span class='line'># dump mDNSRepsonder's internal state.
</span><span class='line'>sudo killall -INFO mDNSResponder</span></code></pre></td></tr></table></div></figure>


<p>졸려서 두서없이 정리함..
나중에 다시 좀더 자세하게 정리를..</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-05-17T02:24:09+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/dig/'>dig</a>, <a class='category' href='/blog/categories/dns/'>dns</a>, <a class='category' href='/blog/categories/host/'>host</a>, <a class='category' href='/blog/categories/junos-pulse/'>junos pulse</a>, <a class='category' href='/blog/categories/mac/'>mac</a>, <a class='category' href='/blog/categories/nslookup/'>nslookup</a>, <a class='category' href='/blog/categories/ping/'>ping</a>, <a class='category' href='/blog/categories/resolver/'>resolver</a>, <a class='category' href='/blog/categories/ssh/'>ssh</a>, <a class='category' href='/blog/categories/vpn/'>vpn</a>


</div>
	
	<div class="comments"><a href="/blog/2016/05/17/mac-os-x-nslookup/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/05/10/management-multiple-openstack-cluster-with-automatic-openstack-rc-file-loader-script/">
		
			Management Multiple Openstack Cluster With Automatic Openstack Rc File Loader Script</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2016-05-10_03-40-27.jpg" width="368" height="272"></p>

<h2>openstack rc file</h2>

<p>여러 openstack 클러스터를 관리하려면 <a href="http://docs.openstack.org/user-guide/common/cli_set_environment_variables_using_openstack_rc.html">openstack rc file</a>(이하 openrc file)을 잘 관리해야한다.  <br/>
이런 관리를 위해서 <a href="http://supernova.readthedocs.io/en/latest/">supernova</a> 와 같은 rc file 관리해주는 툴들을 사용하게 된다.  <br/>
(개인적으로 비슷한 시기에 bash로 비슷한 아이디어로 구현해서 써서 사용하진 않았지만 이러한 관리 툴이 필요하다면 supernova를 참고하면 좋을것같다.)  <br/>
이런 툴들은 기본적으로 shell에 환경변수를 추가하는 방식이기에 폴더가 변경된다고 자동으로 로딩된다기 보다는  <br/>
유저가 어떤 rc file을 사용할지 로딩하여(트리거링하여) 써야한다.</p>

<h2>openstack rc file (normal version)</h2>

<p>예를 들면 아래는 일반적으로 사용하는 익숙 한 예이다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>al@MacBook-Pro-2:~
</span><span class='line'><span class="nv">$ </span><span class="nb">source </span>stage_v1_openrc
</span><span class='line'>
</span><span class='line'>al@MacBook-Pro-2:~
</span><span class='line'><span class="nv">$ </span>env <span class="p">|</span> grep OS_
</span><span class='line'><span class="nv">OS_SERVICE_TOKEN</span><span class="o">=</span>token4service4v1
</span><span class='line'><span class="nv">OS_REGION_NAME</span><span class="o">=</span>stage-v1
</span><span class='line'><span class="nv">OS_SERVICE_ENDPOINT</span><span class="o">=</span>https://stage-v1.example.com/v2.0
</span><span class='line'><span class="nv">OS_PASSWORD</span><span class="o">=</span>password4admin4v1
</span><span class='line'><span class="nv">OS_AUTH_URL</span><span class="o">=</span>https://stage-v1.example.com/v2.0/
</span><span class='line'><span class="nv">OS_USERNAME</span><span class="o">=</span>admin-v1
</span><span class='line'><span class="nv">OS_TENANT_NAME</span><span class="o">=</span>admin-v1
</span><span class='line'>
</span><span class='line'>al@MacBook-Pro-2:~
</span><span class='line'><span class="nv">$ </span><span class="nb">source </span>stage_v2_openrc
</span><span class='line'>
</span><span class='line'>al@MacBook-Pro-2:~
</span><span class='line'><span class="nv">$ </span>env <span class="p">|</span> grep OS_
</span><span class='line'><span class="nv">OS_SERVICE_TOKEN</span><span class="o">=</span>token4service4v2
</span><span class='line'><span class="nv">OS_REGION_NAME</span><span class="o">=</span>stage-v2
</span><span class='line'><span class="nv">OS_SERVICE_ENDPOINT</span><span class="o">=</span>https://stage-v2.example.com/v2.0
</span><span class='line'><span class="nv">OS_PASSWORD</span><span class="o">=</span>password4admin4v2
</span><span class='line'><span class="nv">OS_AUTH_URL</span><span class="o">=</span>https://stage-v2.example.com/v2.0/
</span><span class='line'><span class="nv">OS_USERNAME</span><span class="o">=</span>admin-v2
</span><span class='line'><span class="nv">OS_TENANT_NAME</span><span class="o">=</span>admin-v2
</span></code></pre></td></tr></table></div></figure>


<p>위와 같이 <code>source</code>(혹은 <code>.</code>) 을 이용해서 미리 기록해둔 파일(stage_v1_openrc, stage_v2_openrc)를 export 해서 환경변수에 기록해서 사용한다.  <br/>
이런방식은 어째뜬 파일을 관리해야 하고 파일을 항상 사용해야 하기때문에 다른 디렉토리에서 사용하기에 불편함이 있다.</p>

<h2>openstack rc file (advanced version)</h2>

<p>그래서 내가 만들었던 툴은 아래와 같이 사용했다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>al@MacBook-Pro-2:~ O:stage_v2
</span><span class='line'><span class="nv">$ </span>rcvm stage_v1
</span><span class='line'>OPENRC: stage_v1
</span><span class='line'>
</span><span class='line'>al@MacBook-Pro-2:~ O:stage_v1
</span><span class='line'><span class="nv">$ </span>env <span class="p">|</span> grep OS_
</span><span class='line'><span class="nv">OS_SERVICE_TOKEN</span><span class="o">=</span>token4service4v1
</span><span class='line'><span class="nv">OS_REGION_NAME</span><span class="o">=</span>stage-v1
</span><span class='line'><span class="nv">OS_SERVICE_ENDPOINT</span><span class="o">=</span>https://stage-v1.example.com/v2.0
</span><span class='line'><span class="nv">OS_PASSWORD</span><span class="o">=</span>password4admin4v1
</span><span class='line'><span class="nv">OS_AUTH_URL</span><span class="o">=</span>https://stage-v1.example.com/v2.0/
</span><span class='line'><span class="nv">OS_USERNAME</span><span class="o">=</span>admin-v1
</span><span class='line'><span class="nv">OS_TENANT_NAME</span><span class="o">=</span>admin-v1
</span><span class='line'>
</span><span class='line'>al@MacBook-Pro-2:~ O:stage_v1
</span><span class='line'><span class="nv">$ </span>rcvm stage_v2
</span><span class='line'>OPENRC: stage_v2
</span><span class='line'>
</span><span class='line'>al@MacBook-Pro-2:~ O:stage_v2
</span><span class='line'><span class="nv">$ </span>env <span class="p">|</span> grep OS_
</span><span class='line'><span class="nv">OS_SERVICE_TOKEN</span><span class="o">=</span>token4service4v2
</span><span class='line'><span class="nv">OS_REGION_NAME</span><span class="o">=</span>stage-v2
</span><span class='line'><span class="nv">OS_SERVICE_ENDPOINT</span><span class="o">=</span>https://stage-v2.example.com/v2.0
</span><span class='line'><span class="nv">OS_PASSWORD</span><span class="o">=</span>password4admin4v2
</span><span class='line'><span class="nv">OS_AUTH_URL</span><span class="o">=</span>https://stage-v2.example.com/v2.0/
</span><span class='line'><span class="nv">OS_USERNAME</span><span class="o">=</span>admin-v2
</span><span class='line'><span class="nv">OS_TENANT_NAME</span><span class="o">=</span>admin-v2
</span></code></pre></td></tr></table></div></figure>


<p>사실 source 같은 커맨드와 지정한 파일을 사용하는거 외에 사용방식은 비슷하다.  <br/>
<code>&lt;커맨드&gt; &lt;구성&gt;</code> 이런 호출을 통해서 rc를 변경한다. (위 보다 디렉토리 제약과 파일 관리의 부담이 조금 줄었다.)</p>

<h2>기존 방법의 불편한 점</h2>

<p>위의 두가지 방법들은 한 클러스터를 집중적으로 관리할때 편리하다.</p>

<p>여기서 만약 다른 클러스터 작업이 필요하면 대략 아래 같은 방법의 옵션들을 사용하게 된다.</p>

<pre><code>1. shell을 추가적으로 띄워서 다른 환경변수를 로딩한다.
2. supernova의 사용법중 하나인매번 `supernova &lt;environment&gt; &lt;command&gt;` 와 같은 형태로 환경변수를 로딩하여 호출해야 한다.
</code></pre>

<p>하지만 이렇게 관리하다보면 여러 클러스터에 간단한 작업을 할때마다 여러창을 띄우던지 아니면 의식적으로 환경을 변경하면서 작업해야한다.</p>

<p><em>그래서 아래 같은 방법을 생각하게 되었다.</em></p>

<h2>디렉토리 기반 openrc 자동 로딩 방법</h2>

<p>그래서 생각한 아이디어는 git 이나 chef 등과 같이 parent directory 에 특정 구성 파일이 있으면  <br/>
이하 디렉토리에서 해당 환경을 자동으로 로딩할 수 있으면 편하겠다고 생각했다.  <br/>
가장 간단한 방법은 아마 nova 와 같은 커맨드에 <code>pwd</code> 등을 확인해서 파일을 로딩하는식으로 구현할까 했었다.  <br/>
하지만 이건 새로운 커맨드가 나올때마다 등 관리가 잘 안될게 뻔하기 때문에 이런 방법을 쓰지않고 있었다.</p>

<p>그러던 와중에 <a href="https://github.com/yyuu/pyenv">pyenv</a>를 잘 쓰고 있었는데 여기에서 python command 들을 사용할때 hook을 걸 수 있는것을 알았다.  <br/>
그리고 해당 hook에 부모 디렉토리에 원하는 파일(openrc)이 있으면 로딩하는 식으로 구성하니 아주 말끔히 원하는식으로 작동하게 되었다.</p>

<p>hook 위치는 아래를 참고하면 된다.</p>

<p>mac에서 brew 로 pyenv를 설치했다면 아래와 같다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># mac os x</span>
</span><span class='line'><span class="nv">$ </span>cat <span class="k">$(</span>brew --prefix pyenv<span class="k">)</span>/pyenv.d/exec/openstack.bash
</span></code></pre></td></tr></table></div></figure>


<p>ubuntu는 아래와 같다. (non root user시)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ubuntu</span>
</span><span class='line'><span class="nv">$ </span>cat ~/.pyenv/pyenv.d/exec/openstack.bash
</span></code></pre></td></tr></table></div></figure>


<p>해당 파일내용은 아래와 같다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">openstack_root</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span> -P 2&gt;/dev/null <span class="o">||</span> <span class="nb">command pwd</span><span class="k">)</span>
</span><span class='line'><span class="k">while</span> <span class="o">[</span> ! -e <span class="s2">&quot;$openstack_root/openrc&quot;</span> <span class="o">]</span><span class="p">;</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>  <span class="nv">openstack_root</span><span class="o">=</span><span class="k">${</span><span class="nv">openstack_root</span><span class="p">%/*</span><span class="k">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$openstack_root&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nb">break</span>
</span><span class='line'><span class="nb">  </span><span class="k">fi</span>
</span><span class='line'><span class="k">done</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$openstack_root&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  <span class="k">while</span> <span class="nb">read </span>var<span class="p">;</span> <span class="k">do</span> <span class="nb">unset</span> <span class="s2">&quot;$var&quot;</span><span class="p">;</span> <span class="k">done</span>&lt; &lt;<span class="o">(</span>env <span class="p">|</span> awk -F<span class="o">=</span> <span class="s1">&#39;/^OS_/{print $1}&#39;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  . <span class="s2">&quot;$openstack_root/openrc&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>약간에 설명을 하자면 해당 커맨드를 실행하는 해당 디렉토리에 <code>openrc</code> 파일이 있으면 <code>OS_</code>로 시작하는 모든 환경 변수를 초기화(unset)하고 openrc 를 export 한다.  <br/>
만약 해당 디렉토리에 해당 파일(openrc)가 없으면 상위 디렉토리가 존재할때까지 recursive 하게 올라간다.</p>

<h2>디렉토리 기반 openrc 자동 로딩 데모</h2>

<p>아래는 데모이다.  <br/>
천천히 보려면 이 링크에서 커맨드를 확인하면서 볼 수 있다. (<a href="http://showterm.io/112d21ab5f83d5843f7b2">http://showterm.io/112d21ab5f83d5843f7b2</a>)</p>

<div class="embed-video-container"><iframe width="560" height="315" src="https://www.youtube.com/embed/r_Hgitz0Tn0" frameborder="0" allowfullscreen></iframe></div>


<p>중간에 보이는바와 같이 <code>env | grep OS_</code> 로 환경변수가 비어 있으나  <br/>
<code>python</code> 커맨드 실행시 안에 환경변수들이 채워져 있는 것을 확인 할 수 있다.  <br/>
아래 커맨드로 python 실행시 해당 환경변수중 <code>OS_</code> 시작하는 변수들의 값을 출력해 본것이다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python -c <span class="s2">&quot;import os; print(&#39;\n&#39;.join([str(\&quot;%s=%s\&quot; %(i,j)) for i,j in os.environ.iteritems() if i.startswith(&#39;OS_&#39;)]))&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>이런식으로 앞서 말한 방법과 함께 두가지 방법을 이용하면 보다 쾌적한 클러스터 관리를 할 수 있게 된다.</p>

<h2>DIY</h2>

<p>아래 스크립트를 이용하면 ubuntu에서 테스트 설치해서 테스트 가능하다.</p>

<figure class='code'><figcaption><span>install_openrc_changer.sh</span><a href='https://gist.github.com/leoh0/21d61d3bebe394d278e6f18d5465415d'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'>
</span><span class='line'>sudo apt-get install -qqy git make build-essential libssl-dev zlib1g-dev libbz2-dev <span class="se">\</span>
</span><span class='line'>  libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev <span class="se">\</span>
</span><span class='line'>  libncursesw5-dev libxml2-dev libxslt1-dev libffi-dev
</span><span class='line'>
</span><span class='line'>curl -sL https://raw.github.com/yyuu/pyenv-installer/master/bin/pyenv-installer <span class="p">|</span> <span class="se">\</span>
</span><span class='line'>  bash
</span><span class='line'>
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;~/.pyenv/bin:$PATH&quot;</span>
</span><span class='line'><span class="nb">eval</span> <span class="s2">&quot;$(pyenv init -)&quot;</span>
</span><span class='line'><span class="nb">eval</span> <span class="s2">&quot;$(pyenv virtualenv-init -)&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;export PATH=&quot;~/.pyenv/bin:$PATH&quot;&#39;</span> &gt;&gt; ~/.bashrc
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;eval &quot;$(pyenv init -)&quot;&#39;</span> &gt;&gt; ~/.bashrc
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;eval &quot;$(pyenv virtualenv-init -)&quot;&#39;</span> &gt;&gt; ~/.bashrc
</span><span class='line'>
</span><span class='line'><span class="nv">PYTHON_CONFIGURE_OPTS</span><span class="o">=</span><span class="s2">&quot;--enable-unicode=ucs4&quot;</span> ~/.pyenv/bin/pyenv install 2.7.9
</span><span class='line'>
</span><span class='line'>~/.pyenv/bin/pyenv global 2.7.9
</span><span class='line'>
</span><span class='line'>cat <span class="s">&lt;&lt; OPENRC_CHOOSER &gt; ~/.pyenv/pyenv.d/exec/openstack.bash</span>
</span><span class='line'><span class="s">openstack_root=\$(pwd -P 2&gt;/dev/null || command pwd)</span>
</span><span class='line'><span class="s">while [ ! -e &quot;\$openstack_root/openrc&quot; ];</span>
</span><span class='line'><span class="s">do</span>
</span><span class='line'><span class="s">  openstack_root=\${openstack_root%/*}</span>
</span><span class='line'><span class="s">  if [ &quot;\$openstack_root&quot; == &quot;&quot; ]; then</span>
</span><span class='line'><span class="s">    break</span>
</span><span class='line'><span class="s">  fi</span>
</span><span class='line'><span class="s">done</span>
</span><span class='line'>
</span><span class='line'><span class="s">if [ &quot;\$openstack_root&quot; != &quot;&quot; ]; then</span>
</span><span class='line'><span class="s">  while read var; do unset &quot;\$var&quot;; done&lt; &lt;(env | awk -F= &#39;/^OS_/{print \$1}&#39;)</span>
</span><span class='line'>
</span><span class='line'><span class="s">  . &quot;\$openstack_root/openrc&quot;</span>
</span><span class='line'><span class="s">fi</span>
</span><span class='line'><span class="s">OPENRC_CHOOSER</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;need relogin&#39;</span>
</span><span class='line'><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<h2>결론</h2>

<p>pyenv + 스크립트 한개 = 디렉토리 기반 자동 openrc file loader 제작 가능</p>

<h3>ps</h3>

<p>더 좋은 방법은 언제든지 환영합니다.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-05-10T01:08:56+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/automatic/'>automatic</a>, <a class='category' href='/blog/categories/multiple-cluster/'>multiple cluster</a>, <a class='category' href='/blog/categories/openrc/'>openrc</a>, <a class='category' href='/blog/categories/openstack/'>openstack</a>, <a class='category' href='/blog/categories/rc/'>rc</a>


</div>
	
	<div class="comments"><a href="/blog/2016/05/10/management-multiple-openstack-cluster-with-automatic-openstack-rc-file-loader-script/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/04/27/keystoneeseo-token-backendro-sayonghaneun-memcachedga-unbalanceddoeeossdamyeon-dot/">
		
			Keystone에서 Token Backend로 사용하는 Memcached가 Unbalanced되었다..</a>
	</h2>
	<div class="entry-content">
		<p>해당 클러스터는 kilo 버전으로 구성 되었었고 token 을 memcached 에 저장하고 있었다.  <br/>
또한 kilo 부터 dogpile.cache 는 거의 고정으로 들어가 있가 있어서 해당 모듈을 사용했다.  <br/>
이런 상황을 디버깅 했던 경험을 정리해 본다.</p>

<p>아래는 문제가 되었던 memcached host의 in/out bound 그래프이다.  <br/>
수치는 가려서 스케일만 감으로 볼 수 있게 남겼다.</p>

<p><strong>A 서버</strong>
<img src="/images/2016-04-26_23-50-30.png" width="508" height="122" title="A 서버" ></p>

<p><strong>B 서버</strong>
<img src="/images/2016-04-26_23-50-41.png" width="499" height="122" title="B 서버" ></p>

<p>최초엔 keystone과 memcached connection 이 unbalance 할것이라고 생각했으나 그런 정황은 없었다.    (connection 개수가 일정) 그리고 특별히 keystone 로그에도 별다른 문제가 보이지 않았다.  <br/>
memcache key 개수는 심지어 <strong>A 서버</strong>가 많았다.</p>

<p>이 외에도 온갖 삽질을 했지만 관련이 없었다.  <br/>
그 후 결국 아래와 같은 방법으로 디버깅 할 수 있었다.</p>

<p>각 호스트에서 아래 같이 memcache slab id 별로 dump를 떠보니 <code>bf81985d70a6416897edbade7a8bfc0a5a579af4</code> 와 같이 유독 큰 (578966 b) 키가 <strong>B 서버</strong>에만 존재 하고 있었다.</p>

<p>대부분의 token 데이터는 <code>3f786850e387550fdab836ed7e6dc881de23001b</code> 정도와 같이 PKI가 아닌 UUID token data여서 10000 b 정도를 구성하고 있었기 때문에 <code>크기</code>가 더 눈에 띈다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ for i in $(echo 'stats items' | nc localhost 11211 | cut -d':' -f2 | sort -u | grep -v END); do
</span><span class='line'>    echo "stats cachedump $i 1" | nc localhost 11211
</span><span class='line'>done
</span><span class='line'>...
</span><span class='line'>ITEM 3f786850e387550fdab836ed7e6dc881de23001b [11651 b; 1461686308 s]
</span><span class='line'>END
</span><span class='line'>ITEM 6e49b86a7502dae881f3b9466ecbdfa4743c7eb9 [578966 b; 1461688011 s]
</span><span class='line'>END
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>그렇다면 이 키를 열어 보면 아래와 같다.  <br/>
( 참고로 아래 커맨드를 쓰기위해선 <code>dogpile.cache</code> 가 인스톨 되어 있어야 한다. )</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo get 6e49b86a7502dae881f3b9466ecbdfa4743c7eb9 | nc localhost 11211 | python -c '
</span><span class='line'>import sys
</span><span class='line'>import cPickle
</span><span class='line'>import json
</span><span class='line'>try:
</span><span class='line'>    data=cPickle.load(sys.stdin)
</span><span class='line'>    print json.dumps(data)
</span><span class='line'>except (cPickle.UnpicklingError, EOFError):
</span><span class='line'>    print ""
</span><span class='line'>' | python -mjson.tool
</span><span class='line'>[
</span><span class='line'>    [
</span><span class='line'>        [
</span><span class='line'>            "386c0e0a01bb4069904d9c11771516a2",
</span><span class='line'>            "2016-04-26T15:41:25.000000Z"
</span><span class='line'>        ],
</span><span class='line'>        [
</span><span class='line'>            "9ba06233d0894aa4a06d4302800035c1",
</span><span class='line'>            "2016-04-26T15:41:24.000000Z"
</span><span class='line'>        ],
</span><span class='line'>        [
</span><span class='line'>            "1510940842f943b798f4bb9f7964aa67",
</span><span class='line'>            "2016-04-26T15:41:24.000000Z"
</span><span class='line'>        ],
</span><span class='line'>   
</span><span class='line'>        ...
</span><span class='line'>   
</span><span class='line'>        [
</span><span class='line'>            "d57b2946174c4a4391496a7f9af7e0c5",
</span><span class='line'>            "2016-04-26T16:41:18.000000Z"
</span><span class='line'>        ]
</span><span class='line'>    ],
</span><span class='line'>    {
</span><span class='line'>        "ct": 1461685284.976144,
</span><span class='line'>        "v": 1
</span><span class='line'>    }
</span><span class='line'>]</span></code></pre></td></tr></table></div></figure>


<p>위와 같이 되어 있고 알고 보면 특정 토큰들과 그 토큰이 issue 된 시간이 적혀 있는 <a href="https://github.com/openstack/keystone/blob/stable/kilo/keystone/token/persistence/backends/kvs.py#L155-L188">리스트</a> 이다.  <br/>
이 키의 리스트는 유저별로 token의 expire time을 관리하는 값으로 해당 user에게 token이 발급 되거나 expire 될때마다 해당 리스트를 memcache로 부터 가져와서(<code>get</code>) 다시 업로드(<code>set</code>) 한다.  <br/>
그렇기 때문에 해당 키값이 결국 유저와 관계 있다는 것을 추측할 수 있었다.</p>

<p>예를 들어 아래 처럼 특정 유저를 본다면 아래 처럼 <code>id</code>를 갖고 있을 것이다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ openstack user show ceilometer
</span><span class='line'>+----------+----------------------------------+
</span><span class='line'>| Field    | Value                            |
</span><span class='line'>+----------+----------------------------------+
</span><span class='line'>| enabled  | True                             |
</span><span class='line'>| id       | eef939600bc111e69aeb57d4fa849231 |
</span><span class='line'>| name     | ceilometer                       |
</span><span class='line'>| username | ceilometer                       |
</span><span class='line'>+----------+----------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>eef939600bc111e69aeb57d4fa849231 이값은 아래와 같이 prefix가 붙고 hash 되서 key 값으로 사용된다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo -n 'usertokens-eef939600bc111e69aeb57d4fa849231' | sha1sum
</span><span class='line'>6e49b86a7502dae881f3b9466ecbdfa4743c7eb9  -</span></code></pre></td></tr></table></div></figure>


<p>즉, <code>6e49b86a7502dae881f3b9466ecbdfa4743c7eb9</code>은 가 key이 기때문에 위의 토큰 리스트는 ceilometer의 토큰 리스트인걸 알 수 있다.</p>

<p>마지막으로 아래와 같이 계산해 보면 어떤 멤캐쉬에 들어갈 지 알수 있다. (<a href="https://github.com/linsomniac/python-memcached/blob/master/memcache.py#L63-L66">cmemcache_hash</a> 참고)  <br/>
여기에서는 <code>3065</code> 가 나왔기 때문에 멤캐쉬 서버가 두대이면 두번째(<code>3016%2=1</code>) 서버로 들어가게 된다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo -n '6e49b86a7502dae881f3b9466ecbdfa4743c7eb9' | python -c '
</span><span class='line'>import sys,binascii
</span><span class='line'>print (
</span><span class='line'>    (((binascii.crc32(sys.stdin.read()) & 0xffffffff)
</span><span class='line'>       &gt;&gt; 16) & 0x7fff) or 1)
</span><span class='line'>'
</span><span class='line'>3065</span></code></pre></td></tr></table></div></figure>


<p>나의 케이스는 불운 하게도 이런 많은 토큰을 같은 유저(ceilometer, neutron, nova 등)가 전부 해쉬값이 홀수가 나와서 한 memcached host에 할당되었고, 이때문에 한쪽으로 skew 가 있었다.</p>

<p>이런걸 피할려면 결국 memcached 개수를 늘이던가 토큰이 많은 유저의 uuid를 분배시킬 수 있도록 해야 할것같다.
물론 저런 거대한 토큰 리스트를 관리 안하는 것이 더 나아 보이지만 이 코드는 현재 master(mitaka 이후)까지도 유지되어 있는 상태이다.</p>

<p>우리도 ceilometer 를 쓰기 전까지는 이런 문제가 없었으나 ceilometer를 추가하면서 문제가 발생하기 시작했다.  <br/>
아무래도 ceilometer 상위 버전쪽에서는 토큰의 재활용을 높이는 부분들이 있어야 할것이다.</p>

<p>사족으로 토큰이 어떤 내용을 담고 있는지는 아래 같은 스크립트로 찾으면 편하다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MEMCACHES='serverA serverB'
</span><span class='line'>for h in $MEMCACHES; do
</span><span class='line'>  echo $h
</span><span class='line'>  sha=$(echo -n "token-$1" | sha1sum | cut -d' ' -f1)
</span><span class='line'>  echo get $sha | nc $h 11211 | python -c '
</span><span class='line'>import sys
</span><span class='line'>import cPickle
</span><span class='line'>import json
</span><span class='line'>try:
</span><span class='line'>    data=cPickle.load(sys.stdin)
</span><span class='line'>    data[0]["expires"] = data[0]["expires"].strftime("%Y-%m-%d %H:%M:%S")
</span><span class='line'>    print json.dumps(data[0])
</span><span class='line'>except (cPickle.UnpicklingError, EOFError):
</span><span class='line'>    print ''
</span><span class='line'>' | python -mjson.tool
</span><span class='line'>done</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-04-27T00:00:45+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/keystone/'>keystone</a>, <a class='category' href='/blog/categories/memcached/'>memcached</a>, <a class='category' href='/blog/categories/openstack/'>openstack</a>, <a class='category' href='/blog/categories/skew/'>skew</a>, <a class='category' href='/blog/categories/token/'>token</a>, <a class='category' href='/blog/categories/unbalance/'>unbalance</a>


</div>
	
	<div class="comments"><a href="/blog/2016/04/27/keystoneeseo-token-backendro-sayonghaneun-memcachedga-unbalanceddoeeossdamyeon-dot/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/11/03/maceseo-ntfs-diske-write-hagi/">
		
			Mac에서 Ntfs Disk에 Write 하기</a>
	</h2>
	<div class="entry-content">
		<p>GPT 일때 가능</p>

<div><script src='https://gist.github.com/d07787e9dc635136de6a.js?file=ntfs_mount.sh'></script>
<noscript><pre><code>#!/usr/bin/env bash

if mount | grep -q &#39;ntfs&#39; ; then
  if ! mount | grep -q &#39;read-only&#39; ; then
    echo -e &quot;\033[01;36mExist already in /etc/fstab.\033[00m&quot;
    VOLUME=$(mount | grep &quot;(ntfs, &quot; | sed &#39;s|/dev/disk[0-9]s[0-9] on \(.*\) (ntfs,.*$|\1|g&#39;)
    open &quot;$VOLUME&quot;
    exit
  fi

  DISK=$(mount | grep &#39;read-only&#39; | awk &#39;{print $1}&#39;)
  UUID=$(diskutil info $DISK | grep UUID | awk &#39;{print $3}&#39;)
  echo -e &quot;\033[01;36mRegistry into /etc/fstab.\033[00m&quot;
  echo &quot;UUID=$UUID none ntfs rw,auto,nobrowse&quot; | sudo tee -a /etc/fstab &gt; /dev/null
  diskutil umount $DISK
  diskutil mount $DISK
  VOLUME=$(mount | grep &quot;(ntfs, &quot; | sed &#39;s|/dev/disk[0-9]s[0-9] on \(.*\) (ntfs,.*$|\1|g&#39;)
  open &quot;$VOLUME&quot;
else
  echo -e &quot;\033[01;36mThere is no ntfs disk in here.\033[00m&quot;
fi
</code></pre></noscript></div>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-11-03T09:38:22+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/mac/'>mac</a>, <a class='category' href='/blog/categories/ntfs/'>ntfs</a>


</div>
	
	<div class="comments"><a href="/blog/2015/11/03/maceseo-ntfs-diske-write-hagi/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/19/youtube-chrome-mp3-downloader/">
		
			커맨드로 크롬에 떠 있는 유튜브 플레이중인 음악 Mp3로 다운로드 하기</a>
	</h2>
	<div class="entry-content">
		<p>내가 듣는 음악 장르는 보통 스트리밍 서비스에서 찾을 수 가 없어서 보통 유튜브 자동재생을 켜놓고 음악을 듣는 편이다.</p>

<p>그런데 이런 음악을 찾기 귀찮아서 mp3 파일로 다운로드 해두고 싶은일이 생긴다.</p>

<p><img src="/images/unsun-whispers.png" width="452" height="239" title="unsun - whispers" ></p>

<p><a href="https://www.youtube.com/watch?v=LapknbGS7Os">UNSUN - Whispers Youtube</a></p>

<p>물론 그냥 아래 같이 <code>youtube-dl</code>와 같은 방법을 써도 된다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew install youtube-dl
</span><span class='line'>youtube-dl -t --extract-audio --audio-format mp3 <span class="nv">$YOUTUBEURL</span>
</span></code></pre></td></tr></table></div></figure>


<p>하지만 일하는데 터미널에서 크롬으로 창을 포커스 바꾸고 url을 카피해서 저 커맨드를 넣는건 귀찮은 일이다.</p>

<p>그래서 이런걸 해결해주는 <a href="https://github.com/prasmussen/chrome-cli">chrome-cli</a> 라는 솔루션을 이용한다.</p>

<p>물론 설치는 간단하게..</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew install chrome-cli
</span></code></pre></td></tr></table></div></figure>


<p>그리고 그냥 아래 같은 방법을 쓰면 chrome 에서 열려 있는 유튜브 페이지들을 전부 조회해서 mp3로 다운로드 할 수 있다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="k">function</span> yd<span class="o">(){</span>
</span><span class='line'>  <span class="k">for</span> l in <span class="k">$(</span>chrome-cli list tabs <span class="p">|</span> grep YouTube <span class="p">|</span> cut -d <span class="s1">&#39;[&#39;</span> -f2- <span class="p">|</span> cut -d<span class="s1">&#39;:&#39;</span> -f2- <span class="p">|</span> cut -d<span class="s1">&#39;]&#39;</span> -f1<span class="k">)</span><span class="p">;</span> <span class="k">do</span>
</span><span class='line'>    <span class="nv">url</span><span class="o">=</span><span class="k">$(</span>chrome-cli info -t <span class="nv">$l</span> <span class="p">|</span> grep <span class="s1">&#39;^Url: &#39;</span> <span class="p">|</span> cut -d<span class="s1">&#39; &#39;</span> -f2<span class="k">)</span>
</span><span class='line'>    <span class="o">(</span><span class="nb">cd</span> /want/to/download/mp3<span class="p">;</span> youtube-dl -t --extract-audio --audio-format mp3 <span class="nv">$url</span><span class="o">)</span>
</span><span class='line'>  <span class="k">done</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-05-19T09:49:32+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/brew/'>brew</a>, <a class='category' href='/blog/categories/chrome-cli/'>chrome-cli</a>, <a class='category' href='/blog/categories/youtube-dl/'>youtube-dl</a>


</div>
	
	<div class="comments"><a href="/blog/2015/05/19/youtube-chrome-mp3-downloader/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/04/24/containerize-openstack/">
		
			Containerize Openstack</a>
	</h2>
	<div class="entry-content">
		<p>docker 바깥으로 process를 낼 수 있는 방법들로 kvm 프로세스를 docker 바깥 host os 에 배치시키는 방법이 가능하네요.  <br/>
실질적으로 docker안에 kvm이 들어가게 된다면 docker process에 vm이 종속적이게 되어 불안정한 구성이 될테지만  <br/>
이런 방식으로 피해 갈 수도 있는 것을 확인했습니다.</p>

<p><img src="/images/containerize-openstack.png" width="1440" height="829" title="containerize-openstack" ></p>

<p>아무튼 사진과 같이 기묘한 형태로 (실제 host os 에는 없는 바이너리가 parent 1 을 물고 process 로 뜨게되는) 관리가 가능합니다.  <br/>
물론 보안 적인 결함에 대해서야 아직 끝도없이 이야기할 주제이겠지만 앞으로의 provisioning의 새로운 가능성에 대해서 관심이 가는건 사실인것 같습니다.</p>

<p>아무튼 열심히 삽질하다보니 kolla에서 이미 하고 있었어서 libvirt 를 containerize 하는데 도움을 받았습니다.</p>

<p><a href="https://github.com/stackforge/kolla">https://github.com/stackforge/kolla</a></p>

<p>우선 저는 ubuntu로 kolla 소스가 아니라 따로 구성해서 실험했습니다.  <br/>
fedora와 ubuntu의 미묘한 차이가 있어서 ubuntu로 구성하려면 약간의 차이가 필요한것 같습니다.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-04-24T01:08:16+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/containerize/'>containerize</a>, <a class='category' href='/blog/categories/docker/'>docker</a>, <a class='category' href='/blog/categories/kolla/'>kolla</a>, <a class='category' href='/blog/categories/kvm/'>kvm</a>, <a class='category' href='/blog/categories/libvirt/'>libvirt</a>, <a class='category' href='/blog/categories/openstack/'>openstack</a>, <a class='category' href='/blog/categories/qemu/'>qemu</a>


</div>
	
	<div class="comments"><a href="/blog/2015/04/24/containerize-openstack/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/04/24/gajang-byeontaejeogin-linux-command/">
		
			가장 변태적인 Linux Command</a>
	</h2>
	<div class="entry-content">
		<p>ip command 는 linux network 쪽을 위해 굉장히 많이 사용되는 커맨드 이다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Usage: ip <span class="o">[</span> OPTIONS <span class="o">]</span> OBJECT <span class="o">{</span> COMMAND <span class="p">|</span> <span class="nb">help</span> <span class="o">}</span>
</span><span class='line'>       ip <span class="o">[</span> -force <span class="o">]</span> -batch filename
</span><span class='line'>where  OBJECT :<span class="o">=</span> <span class="o">{</span> link <span class="p">|</span> addr <span class="p">|</span> addrlabel <span class="p">|</span> route <span class="p">|</span> rule <span class="p">|</span> neigh <span class="p">|</span> ntable <span class="p">|</span>
</span><span class='line'>                   tunnel <span class="p">|</span> tuntap <span class="p">|</span> maddr <span class="p">|</span> mroute <span class="p">|</span> mrule <span class="p">|</span> monitor <span class="p">|</span> xfrm <span class="p">|</span>
</span><span class='line'>                   netns <span class="p">|</span> l2tp <span class="p">|</span> tcp_metrics <span class="p">|</span> token <span class="o">}</span>
</span><span class='line'>       OPTIONS :<span class="o">=</span> <span class="o">{</span> -V<span class="o">[</span>ersion<span class="o">]</span> <span class="p">|</span> -s<span class="o">[</span>tatistics<span class="o">]</span> <span class="p">|</span> -d<span class="o">[</span>etails<span class="o">]</span> <span class="p">|</span> -r<span class="o">[</span>esolve<span class="o">]</span> <span class="p">|</span>
</span><span class='line'>                    -f<span class="o">[</span>amily<span class="o">]</span> <span class="o">{</span> inet <span class="p">|</span> inet6 <span class="p">|</span> ipx <span class="p">|</span> dnet <span class="p">|</span> bridge <span class="p">|</span> link <span class="o">}</span> <span class="p">|</span>
</span><span class='line'>                    -4 <span class="p">|</span> -6 <span class="p">|</span> -I <span class="p">|</span> -D <span class="p">|</span> -B <span class="p">|</span> -0 <span class="p">|</span>
</span><span class='line'>                    -l<span class="o">[</span>oops<span class="o">]</span> <span class="o">{</span> maximum-addr-flush-attempts <span class="o">}</span> <span class="p">|</span>
</span><span class='line'>                    -o<span class="o">[</span>neline<span class="o">]</span> <span class="p">|</span> -t<span class="o">[</span>imestamp<span class="o">]</span> <span class="p">|</span> -b<span class="o">[</span>atch<span class="o">]</span> <span class="o">[</span>filename<span class="o">]</span> <span class="p">|</span>
</span><span class='line'>                    -rc<span class="o">[</span>vbuf<span class="o">]</span> <span class="o">[</span>size<span class="o">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>이 커맨드의 가장 변태적이라고 생각한 부분은 다음이다..</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip a
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip ad
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip add
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip addr
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip addre
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip addres
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip address
</span></code></pre></td></tr></table></div></figure>


<p>전부 동일한 결과가&hellip;</p>

<p><code>link</code>, <code>route</code> 등도 다 저렇게 되있다고 보면된다.</p>

<p>별건 아닌데 참 <code>괴상한</code> <code>친절한</code> 커맨드라는 생각이 들어서 ㅋㅋ</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-04-24T00:28:38+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/ip/'>ip</a>


</div>
	
	<div class="comments"><a href="/blog/2015/04/24/gajang-byeontaejeogin-linux-command/#disqus_thread">Comments</a></div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/posts/2" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    leoh0

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'leoh0githubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-46519012-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>